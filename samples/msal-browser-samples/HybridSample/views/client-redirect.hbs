<a href="/">Go Back</a>

<script src="/auth/lib/msal-browser.js"></script>
<script type="text/javascript">
    const msalInstance = new msal.PublicClientApplication({
        auth: {
            clientId: "{{clientId}}",
            redirectUri: "http://localhost:3000/auth/client-redirect",
            authority: "https://login.microsoftonline.com/common"
        }
    })

    msalInstance.handleRedirectPromise()
        .then(result => {
            if (result) {
                console.log('MSAL: Returning from login');
                return result;
            }
            
            const params = new URLSearchParams(document.location.search);
            const sid = params.get("sid");
            const code = params.get("code");
            const nonce = params.get("nonce");
            const loginHint = decodeURIComponent(params.get("login-hint"));

            const hybridParams = code && nonce;

            if (hybridParams) {
                console.log('MSAL: ssoSilent hybrid parameters present');
            } else {
                console.log('MSAL: ssoSilent hybrid parameters not present');
            }

            const ssoSilentParams = hybridParams ? {
                // For hybrid, nonce from server request and auth code are required
                nonce,
                authCodePayload: {
                    code
                }
            } : {
                // For non-hybrid, use login hint or sid
                sid,
                loginHint
            };

            console.log('MSAL: Initiating ssoSilent');
            return msalInstance.ssoSilent(ssoSilentParams)
                .then(result => {
                    console.log('MSAL: ssoSilent completed successfully');
                    return result;
                })
                .catch((error) => {
                    console.log('MSAL: ssoSilent failed, redirecting')
                    return msalInstance.loginRedirect({
                        loginHint
                    })
                })
        })
        .then(result => {
            if (result) {
                console.log('MSAL: ', result);
            }
        })
</script>
